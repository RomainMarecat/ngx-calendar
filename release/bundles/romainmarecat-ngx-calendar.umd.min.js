!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/flex-layout"),require("@angular/material"),require("@ngx-translate/core"),require("@angular/material/snack-bar"),require("moment"),require("twix"),require("rxjs"),require("@angular/fire/firestore"),require("@angular/router"),require("@angular/core"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@romainmarecat/ngx-calendar",["exports","@angular/common","@angular/flex-layout","@angular/material","@ngx-translate/core","@angular/material/snack-bar","moment","twix","rxjs","@angular/fire/firestore","@angular/router","@angular/core","rxjs/operators"],e):e((t.romainmarecat=t.romainmarecat||{},t.romainmarecat["ngx-calendar"]={}),t.ng.common,t.ng["flex-layout"],t.ng.material,t.ngxTranlateCore,t.ng.material["snack-bar"],t.moment,null,t.rxjs,t.ng.fire.firestore,t.ng.router,t.ng.core,t.rxjs.operators)}(this,function(t,e,n,o,s,a,i,r,l,u,d,c,y){"use strict";var p={absence:0,session:1};p[p.absence]="absence",p[p.session]="session";var h=(m.prototype.message=function(t,e){void 0===e&&(e={}),this.toast(t,e)},m.prototype.show=function(t,e){void 0===e&&(e={}),this.toast(t,e)},m.prototype.toast=function(e,n){var o=this;void 0===n&&(n={}),"string"!=typeof e?this.openAlertMessage(e,n):this.translateService.get(e,n).subscribe(function(t){o.openAlertMessage(t,n)},function(t){o.openAlertMessage(e,n)})},m.prototype.openAlertMessage=function(t,e){this.snackBar.open(t,"message",{data:t,panelClass:["snackbar"],duration:8e3})},m.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],m.ctorParameters=function(){return[{type:o.MatSnackBar},{type:s.TranslateService}]},m.ngInjectableDef=c.ɵɵdefineInjectable({factory:function(){return new m(c.ɵɵinject(a.MatSnackBar),c.ɵɵinject(s.TranslateService))},token:m,providedIn:"root"}),m);function m(t,e){this.snackBar=t,this.translateService=e}var f=i,v=(b.prototype.ngOnInit=function(){},b.prototype.onNextDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=f(this.start).add(t,"day"),this.startChanged.emit(this.start)},b.prototype.isAllSlotNotAvailable=function(){var e=this;if(this.days&&0<this.days.length)return 0===this.days.filter(function(t){return 0<e.daysAvailability.get(t.key).length}).length},b.prototype.getAvailabilities=function(t){return this.daysAvailability.get(t)},b.prototype.getSessionTitle=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;if(this.sessions&&this.sessions.has(n)){var o=this.sessions.get(n);return f(o.start).format("HH:mm")+" - "+f(o.end).format("HH:mm")}return""},b.prototype.getSessionTooltip=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;if(this.sessions&&this.sessions.has(n)){var o=this.sessions.get(n);if(o.details.info)return this.translate.instant(o.details.info)}return""},b.prototype.onTimeSlotClicked=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;if(this.isSlotBusy(t,e)||this.isSlotEarly(t,e))this.alertService.show("error.slot.locked");else if(this.isSlotSessionStart(t,e)||this.isSlotInSession(t,e)){if(this.sessions.has(n)){var o={key:n,session:this.sessions.get(n)};this.removeSession(o)}}else{var s=f(n,"YYYY-MM-DDHH:mm"),a=s.clone().add(this.onlineSession.session_type.duration,"minutes");this.addSession(s,a)}},b.prototype.addSession=function(t,e){var n={start:t.toDate(),end:e.toDate(),pause:this.onlineSession.session_type.pause,details:{nb_persons:1,event_type:p.session,info:"calendar.session.info"}};this.sessionAdded.emit(n)},b.prototype.removeSession=function(t){this.sessionRemoved.emit(t)},b.prototype.isDayBusy=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.daysBusySlotNumber&&this.daysAvailabilitySlotNumber&&this.daysBusySlotNumber.has(n)&&this.daysAvailabilitySlotNumber.has(n)&&this.daysBusySlotNumber.get(n)>=this.daysAvailabilitySlotNumber.get(n)},b.prototype.isSlotBusy=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.busySlots&&this.busySlots.has(n)},b.prototype.isSlotEarly=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.earlySlots&&this.earlySlots.has(n)||this.pauseSlots&&this.pauseSlots.has(n)},b.prototype.isSlotInSession=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.sessionsSlots&&this.sessionsSlots.has(n)},b.prototype.isSlotSessionStart=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.sessions&&this.sessions.has(n)},b.prototype.isSlotSessionEnd=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.sessionsEndSlots&&this.sessionsEndSlots.has(n)},b.decorators=[{type:c.Component,args:[{selector:"lib-calendar-body",template:'<div class="calendar-body-wrapper">\n  <table class="calendar-body-table-wrapper table table-bordered">\n    <thead class="calendar-body-table-head">\n    <tr class="calendar-body-head-day-row"\n        *ngIf="viewMode !== \'day\'">\n      <th class="calendar-body-day-header text-center"\n          *ngFor="let day of days">\n        <span class="truncate">{{ day.title }}</span>\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr class="calendar-body-row">\n      <td class="calendar-body-column-content text-center"\n          #dayList\n          [attr.id]="day.key"\n          *ngFor="let day of days; let keyDay = index">\n        <div class="time-slot"\n             [class.busy]="isSlotBusy(day, time)"\n             [class.early]="isSlotEarly(day, time)"\n             [class.session]="isSlotInSession(day, time)"\n             [class.session-start]="isSlotSessionStart(day, time)"\n             [class.session-end]="isSlotSessionEnd(day, time)"\n             *ngFor="let time of getAvailabilities(day.key)">\n          <div class="time-content">\n            <button type="button"\n                    class="slot-available"\n                    color="primary"\n                    mat-raised-button\n                    (click)="onTimeSlotClicked(day, time)"\n                    *ngIf="!isSlotSessionStart(day, time); else sessionTitle">\n              <span class="default-time">{{ time }}</span>\n            </button>\n            <ng-template #sessionTitle>\n              <button type="button"\n                      mat-raised-button\n                      class="slot-session"\n                      [matTooltipPosition]="\'above\'"\n                      [matTooltip]="getSessionTooltip(day, time)">\n                {{ getSessionTitle(day, time)}}\n              </button>\n            </ng-template>\n            <a class="link-close" (click)="onTimeSlotClicked(day, time)">\n              <mat-icon class="icon-close"\n                        *ngIf="isSlotSessionStart(day, time)">close\n              </mat-icon>\n            </a>\n          </div>\n          <div class="slot-busy"\n               *ngIf="getAvailabilities(day.key).length <= 0 || isDayBusy(day, time)">\n            <span>{{ \'calendar.availability.empty\'|translate }}</span>\n          </div>\n        </div>\n        <div class="next-slot"\n             *ngIf="isAllSlotNotAvailable() && keyDay === days.length-1">\n          <button type="button"\n                  role="button"\n                  mat-raised-button\n                  color="primary"\n                  [title]="\'cta.next-available-slot\'|translate"\n                  (click)="onNextDay()">\n            <span>{{ \'cta.next-available-slot\'|translate }}</span>\n            <mat-icon>keyboard_arrow_right</mat-icon>\n          </button>\n        </div>\n      </td>\n    </tr>\n    </tbody>\n  </table>\n</div>\n',styles:[".calendar-body-wrapper .calendar-body-column-content{max-width:240px}.calendar-body-wrapper .calendar-body-column-content .time-slot{padding:5px}.calendar-body-wrapper .calendar-body-column-content .time-slot button.slot-available{cursor:pointer;width:120px}.calendar-body-wrapper .calendar-body-column-content .time-slot:hover button.slot-available{background-color:#006400;color:#fff}.calendar-body-wrapper .calendar-body-column-content .time-slot.busy{display:none}.calendar-body-wrapper .calendar-body-column-content .time-slot.busy button.slot-available{color:#8b0000;cursor:not-allowed}.calendar-body-wrapper .calendar-body-column-content .time-slot.early button.slot-available{cursor:not-allowed;color:orange}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content{position:relative;padding:5px 5px 5px 0}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .slot-session{width:120px;background-color:#ff8c00}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .link-close .icon-close{position:absolute;right:5px;top:5px;font-size:14px}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .link-close,.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .link-close:hover{cursor:pointer}.calendar-body-wrapper .calendar-body-column-content .time-slot.session-start{border-top-left-radius:3px;border-top-right-radius:3px}.calendar-body-wrapper .calendar-body-column-content .time-slot.session-start .slot-session{color:#000;cursor:text}.calendar-body-wrapper .calendar-body-column-content .time-slot.session-end{border-bottom-left-radius:3px;border-bottom-right-radius:3px}"]}]}],b.ctorParameters=function(){return[{type:s.TranslateService},{type:h}]},b.propDecorators={onlineSession:[{type:c.Input}],viewMode:[{type:c.Input}],start:[{type:c.Input}],end:[{type:c.Input}],days:[{type:c.Input}],daysAvailability:[{type:c.Input}],daysBusySlotNumber:[{type:c.Input}],daysAvailabilitySlotNumber:[{type:c.Input}],busySlots:[{type:c.Input}],earlySlots:[{type:c.Input}],pauseSlots:[{type:c.Input}],sessionsSlots:[{type:c.Input}],sessionsEndSlots:[{type:c.Input}],sessions:[{type:c.Input}],sessionAdded:[{type:c.Output}],sessionRemoved:[{type:c.Output}],startChanged:[{type:c.Output}],endChanged:[{type:c.Output}]},b);function b(t,e){this.translate=t,this.alertService=e,this.sessionAdded=new c.EventEmitter,this.sessionRemoved=new c.EventEmitter,this.startChanged=new c.EventEmitter,this.endChanged=new c.EventEmitter}var S=i,g=(Y.prototype.ngOnInit=function(){},Object.defineProperty(Y.prototype,"viewMode",{get:function(){return this._viewMode},set:function(t){this.switchView(t)},enumerable:!0,configurable:!0}),Y.prototype.switchView=function(t){this._viewMode=t,this.onSwitchedView(t)},Y.prototype.onSwitchedView=function(t){this.switchedView.emit(t)},Y.prototype.onStartChanged=function(t){this.startChanged.emit(t)},Y.prototype.goToToday=function(){this.start=S(),this.onStartChanged(this.start)},Y.prototype.isToday=function(){return S()===S(this.start)},Y.prototype.previousDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=S(this.start).subtract(t,"day"),this.onStartChanged(this.start)},Y.prototype.nextDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=S(this.start).add(t,"day"),this.onStartChanged(this.start)},Y.decorators=[{type:c.Component,args:[{selector:"lib-calendar-header",template:'<div fxLayout="row wrap"\n     fxLayoutAlign="space-between stretch"\n     fxLayout.xs="column"\n     fxLayoutAlign.xs="start center"\n     fxLayoutGap.xs="10px">\n\n  <div class="left-actions"\n       fxLayout="row"\n       fxLayoutAlign="start stretch"\n       fxLayoutGap="10px"\n       fxLayout.xs="row"\n       fxLayoutAlign.xs="center stretch"\n       fxLayoutGap.xs="10px">\n    <button class="button-actions"\n            mat-raised-button\n            color="primary"\n            (click)="previousDay()"\n            type="button"\n            role="button"\n            [title]="\'cta.previous\'|translate">\n      <mat-icon>keyboard_arrow_left</mat-icon>\n    </button>\n    <button class="button-actions"\n            mat-raised-button\n            (click)="nextDay()"\n            color="primary"\n            type="button"\n            role="button"\n            [title]="\'cta.next\'|translate">\n      <mat-icon>keyboard_arrow_right</mat-icon>\n    </button>\n    <button class="button-actions"\n            [title]="\'calendar.back-today\'|translate"\n            mat-raised-button\n            color="primary"\n            [disabled]="isToday()"\n            (click)="goToToday()"\n            role="button">\n      <mat-icon>today</mat-icon>\n    </button>\n  </div>\n  <div class="right-actions"\n       fxLayout="row wrap"\n       fxLayoutAlign="end stretch"\n       fxLayoutGap="10px"\n       fxLayout.xs="row wrap"\n       fxLayoutAlign.xs="center stretch"\n       fxLayoutGap.xs="10px">\n    <button class="button-actions"\n            mat-raised-button\n            type="button"\n            role="button"\n            [title]="\'calendar.today\'|translate"\n            color="primary"\n            [disabled]="true"\n            [class.hide-on-small-only]="end?.format(\'YYYY-MM-DD\') !== start?.format(\'YYYY-MM-DD\')">\n      {{ start?.format(\'LL\') }}\n      <span *ngIf="end?.format(\'YYYY-MM-DD\') !== start?.format(\'YYYY-MM-DD\')">\n        - {{ end?.format(\'LL\') }}\n      </span>\n    </button>\n    <button class="button-actions"\n            mat-raised-button\n            color="primary"\n            type="button"\n            role="button"\n            [title]="\'calendar.week\'|translate"\n            [class.active]="viewMode === \'week\'"\n            (click)="switchView(\'week\')"\n            fxHide.lt-md="true">\n      <mat-icon>view_week</mat-icon>\n      <span fxHide.lt-md="true">{{ \'calendar.week\'|translate }}</span>\n    </button>\n    <button class="button-actions"\n            mat-raised-button\n            color="primary"\n            type="button"\n            role="button"\n            [title]="\'calendar.3days\'|translate"\n            [class.active]="viewMode === \'3days\'"\n            (click)="switchView(\'3days\')"\n            fxHide.lt-md="true">\n      <mat-icon>view_column</mat-icon>\n      <span fxHide.lt-md="true">{{ \'calendar.3days\'|translate }}</span>\n    </button>\n    <button class="button-actions"\n            mat-raised-button\n            color="primary"\n            type="button"\n            role="button"\n            [title]="\'calendar.day\'|translate"\n            [class.active]="viewMode === \'day\'"\n            (click)="switchView(\'day\')"\n            fxHide.lt-md="true">\n      <mat-icon>view_day</mat-icon>\n      <span fxHide.lt-md="true">{{ \'calendar.day\'|translate }}</span>\n    </button>\n  </div>\n</div>\n',styles:[""]}]}],Y.propDecorators={start:[{type:c.Input}],end:[{type:c.Input}],switchedView:[{type:c.Output}],startChanged:[{type:c.Output}],viewMode:[{type:c.Input}]},Y);function Y(){this.switchedView=new c.EventEmitter,this.startChanged=new c.EventEmitter}var D=this&&this.__assign||function(){return(D=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},w=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,s,a=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(o=a.next()).done;)i.push(o.value)}catch(r){s={error:r}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(s)throw s.error}}return i},M=(x.prototype.createQuery=function(t,e,n,o){var s=this;o&&this.query&&(o.limit&&(this.query=this.query.limit(o.limit)),o.filters&&o.filters.forEach(function(t){s.query=s.query.where(t.column,t.operator,t.value)}),o.orderBy&&(this.query=this.query.orderBy(o.orderBy.column,o.orderBy.direction))),e&&(this.query=this.query.limit(e)),t&&this.query&&t.forEach(function(t){s.query=s.query.where(t.column,t.operator,t.value)}),n&&(this.query=this.query.orderBy(n.column,n.direction))},x.prototype.initializeBehaviour=function(t){this.table=t,this.query$=new l.BehaviorSubject(null),this.filters$=new l.BehaviorSubject(null),this.limit$=new l.BehaviorSubject(null),this.orderBy$=new l.BehaviorSubject(null),this.collectionRef=this.afs.collection(this.table)},x.prototype.getDocuments=function(){return this.documents$.pipe(y.map(function(t){return t.map(function(t){if(t.payload.doc.exists){var e=t.payload.doc.data();return e.key=t.payload.doc.id,e}})}))},x.prototype.getDocPayload=function(t){return this.document$=this.collectionRef.doc(t).snapshotChanges().pipe(y.map(function(t){if(t.payload.exists){var e=t.payload.data();return e.key=t.payload.id,e}return null}))},x.prototype.getDocument=function(t){return t?this.getDocPayload(t):l.of(null)},x.prototype.updateDocument=function(t){return this.collectionRef.doc(t.key).update(D({},t))},x.prototype.createDocument=function(t){return this.collectionRef.add(t)},x.prototype.deleteDocument=function(t){return this.collectionRef.doc(t.key)["delete"]()},x.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],x.ctorParameters=function(){return[{type:u.AngularFirestore},{type:String,decorators:[{type:c.Inject,args:["TABLE_NAME"]}]}]},x.ngInjectableDef=c.ɵɵdefineInjectable({factory:function(){return new x(c.ɵɵinject(u.AngularFirestore),c.ɵɵinject("TABLE_NAME"))},token:x,providedIn:"root"}),x);function x(t,e){var i=this;this.afs=t,this.initializeBehaviour(e),this.documents$=l.combineLatest(this.filters$,this.limit$,this.orderBy$,this.query$).pipe(y.switchMap(function(t){var e=w(t,4),n=e[0],o=e[1],s=e[2],a=e[3];return i.afs.collection(i.table,function(t){return i.query=t,i.createQuery(n,o,s,a),i.query}).snapshotChanges()}))}var A,_,k=((this&&this.__extends||(A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}))(I,_=M),I.prototype.getEvents=function(){return _.prototype.getDocuments.call(this)},I.prototype.getEvent=function(t){return _.prototype.getDocument.call(this,t)},I.prototype.createEvent=function(t){return _.prototype.createDocument.call(this,t)},I.prototype.updateEvent=function(t){return _.prototype.updateDocument.call(this,t)},I.prototype.deleteEvent=function(t){return _.prototype.deleteDocument.call(this,t)},I.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],I.ctorParameters=function(){return[{type:u.AngularFirestore},{type:String,decorators:[{type:c.Inject,args:["TABLE_EVENT"]}]}]},I.ngInjectableDef=c.ɵɵdefineInjectable({factory:function(){return new I(c.ɵɵinject(u.AngularFirestore),c.ɵɵinject("TABLE_EVENT"))},token:I,providedIn:"root"}),I);function I(t,e){return _.call(this,t,e)||this}var E,B,H=((this&&this.__extends||(E=function(t,e){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}E(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}))(N,B=M),N.prototype.getSessions=function(){return B.prototype.getDocuments.call(this)},N.prototype.getSession=function(t){return B.prototype.getDocument.call(this,t)},N.prototype.createSession=function(t){return B.prototype.createDocument.call(this,t)},N.prototype.updateSession=function(t){return B.prototype.updateDocument.call(this,t)},N.prototype.deleteSession=function(t){return B.prototype.deleteDocument.call(this,t)},N.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],N.ctorParameters=function(){return[{type:u.AngularFirestore},{type:String,decorators:[{type:c.Inject,args:["TABLE_SESSION"]}]}]},N.ngInjectableDef=c.ɵɵdefineInjectable({factory:function(){return new N(c.ɵɵinject(u.AngularFirestore),c.ɵɵinject("TABLE_SESSION"))},token:N,providedIn:"root"}),N);function N(t,e){return B.call(this,t,e)||this}var j=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,s,a=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(o=a.next()).done;)i.push(o.value)}catch(r){s={error:r}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(s)throw s.error}}return i},C=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(j(arguments[e]));return t},T=i,O=(L.splitRangeToNextTime=function(t,e){var n=t.next();return{time:n,mmtTime:L.getMinutesDifference(T(n.toDate()),e)}},L.getMinutesDifference=function(t,e){return t.minutes()%e!=0&&t.minutes(t.minutes()-t.minutes()%e),t},L.prototype.ngOnInit=function(){this.setCalendar(),this.setDateRange()},Object.defineProperty(L.prototype,"viewMode",{get:function(){return this._viewMode},set:function(t){this._viewMode=t,this.setViewMode()},enumerable:!0,configurable:!0}),L.prototype.ngOnChanges=function(){this.setDateRange()},L.prototype.setCalendar=function(){this.onlineSession={key:"test1",session_type:{name:"test1",max_persons:1,booking_delay:1,duration:60,pause:0},prices:[10,20],date_range:{start:"2018-01-01",end:"2019-12-31"},time_range:{start:"08:00",end:"19:00"}},this.sessionsSlots=new Set,this.sessionsEndSlots=new Set,this.earlySlots=new Set,this.pauseSlots=new Set,this.sessions=new Map},L.prototype.setViewMode=function(){return"day"===this.viewMode?this.end=this.start:"3days"===this.viewMode?this.end=T(this.start).add(2,"days"):(this.start||(this.start=T()),this.start=T(this.start).day(0),this.end=T(this.start).add(6,"days")),this.calendarStart=T(this.start).startOf("day"),void(this.calendarEnd=T(this.end).endOf("day"))},L.prototype.setDateRange=function(){this.setCalendar(),this.setViewMode(),this.loadEvents(this.start,this.end),this.daysAvailability=new Map;var t=this.start.twix(this.end).iterate(1,"days");for(this.days=[];t.hasNext();){var e=t.next();this.days.push({title:e.format("DD/MM/YYYY"),key:e.format("YYYY-MM-DD"),value:T(e.toDate())}),this.daysAvailability.set(e.format("YYYY-MM-DD"),[])}this.loadAvailabilities()},L.prototype.onSwithedView=function(t){this.viewModeChanged.emit(t),this.setDateRange()},L.prototype.onStartChanged=function(t){this.start=t,this.setDateRange()},L.prototype.onSessionAdded=function(t){this.sessions.set(T(t.start).format("YYYY-MM-DDHH:mm"),t),this.addSession(t),this.sessionCreated.emit(t)},L.prototype.onSessionRemoved=function(t){this.sessions["delete"](t.key),this.removeSession(t.session),this.sessionRemoved.emit(t.session)},L.prototype.loadAvailabilities=function(){var u=this;if(this.daysAvailability&&this.onlineSession){var d=this.onlineSession.session_type.duration,c=T(this.onlineSession.date_range.start,"YYYY-MM-DD").startOf("day"),y=T(this.onlineSession.date_range.end,"YYYY-MM-DD").endOf("day");this.daysAvailabilitySlotNumber=new Map,this.daysAvailability.forEach(function(t,e){var n=0,o=T(e,"YYYY-MM-DD").hour(8),s=T(e+u.onlineSession.time_range.start,"YYYY-MMDDHH:mm");if(!s.isBefore(T().startOf("day"))){var a=T().add(u.onlineSession.session_type.booking_delay,"hours"),i=T(e+u.onlineSession.time_range.end,"YYYY-MM-DDHH:mm");i.subtract(d,"minutes");var r=s.twix(i).iterate(u.slotDuration,"minutes");if(u.calendarStart&&u.calendarEnd&&o.isBetween(c,y))for(;r.hasNext();){var l=r.next();T(l.toDate()).isBefore(a)||(t.push(l.format("HH:mm")),n++)}u.daysAvailabilitySlotNumber.set(e,n)}})}},L.prototype.addSession=function(t){for(var e=T(t.start),n=T(t.end),o=e.twix(n).iterateInner(this.slotDuration,"minutes");o.hasNext();){var s=o.next();this.sessionsSlots.add(s.format("YYYY-MM-DDHH:mm")),o.hasNext()||this.sessionsEndSlots.add(s.format("YYYY-MM-DDHH:mm"))}var a=e.clone().subtract(this.trueDuration,"minutes");a.minutes(a.minutes()-a.minutes()%this.slotDuration+this.slotDuration);for(var i=a.twix(e).iterate(this.slotDuration,"minutes");i.hasNext();)s=i.next(),(d=L.getMinutesDifference(T(s.toDate()),this.slotDuration)).isSameOrAfter(a)&&d.isBefore(e)&&this.earlySlots.add(d.format("YYYY-MM-DDHH:mm"));var r=n.clone();r.subtract(r.minutes()%this.slotDuration);for(var l=r.clone().add(this.onlineSession.session_type.pause,"minutes"),u=r.twix(l).iterate(this.slotDuration,"minutes");u.hasNext();){var d;s=u.next(),(d=L.getMinutesDifference(T(s.toDate()),this.slotDuration)).isSameOrAfter(r)&&d.isBefore(l)&&this.pauseSlots.add(d.format("YYYY-MM-DDHH:mm"))}},L.prototype.removeSession=function(t){for(var e=T(t.start),n=T(t.end),o=e.twix(n).iterate(this.slotDuration,"minutes");o.hasNext();){var s=o.next();this.sessionsSlots["delete"](s.format("YYYY-MM-DDHH:mm")),o.hasNext()||this.sessionsEndSlots["delete"](s.format("YYYY-MM-DDHH:mm"))}var a=e.clone().subtract(this.trueDuration,"minutes");a.minutes(a.minutes()-a.minutes()%this.slotDuration+this.slotDuration);for(var i=a.twix(e).iterate(this.slotDuration,"minutes");i.hasNext();)s=i.next(),(d=L.getMinutesDifference(T(s.toDate()),this.slotDuration)).isSameOrAfter(a)&&d.isBefore(e)&&this.earlySlots["delete"](d.format("YYYY-MM-DDHH:mm"));if(t.pause){var r=n.clone();r.subtract(r.minutes()%this.slotDuration);for(var l=r.clone().add(t.pause,"minutes"),u=r.twix(l).iterate(this.slotDuration,"minutes");u.hasNext();){var d;s=u.next(),(d=L.getMinutesDifference(T(s.toDate()),this.slotDuration)).isSameOrAfter(r)&&d.isBefore(l)&&this.pauseSlots["delete"](d.format("YYYY-MM-DDHH:mm"))}}},L.prototype.loadEvents=function(t,e){var n=this;this.sessionService.filters$.next([{column:"start",operator:">=",value:T(t).toDate()}]),this.sessionService.getSessions().subscribe(function(t){n.events=C(t.filter(function(t){return t&&t.end<=e.toDate()})),n.busySlots=new Set,n.daysBusySlotNumber=new Map,n.events.forEach(function(t){var e=T(t.start,"YYYY-MM-DDHH:mm");e=n.buildinBusySlot(e,t),n.buildingEarliestSlot(e)}),n.cd.markForCheck()})},L.prototype.buildinBusySlot=function(t,e){var n=T(e.end,"YYYY-MM-DDHH:mm");if(!(t&&t.isValid()&&n&&n.isValid()&&t.isBefore(n)))return console.error("invalid dates"),null;for(var o=t.twix(n).iterate(this.slotDuration,"minutes");o.hasNext();){var s=L.splitRangeToNextTime(o,this.slotDuration),a=s.time;if(s.mmtTime,this.daysAvailability&&this.daysAvailability.has(a.format("YYYY-MM-DD"))&&!this.busySlots.has(a.format("YYYY-MM-DDHH:mm"))&&0<=this.daysAvailability.get(a.format("YYYY-MM-DD")).indexOf(a.format("HH:mm"))){var i=this.daysBusySlotNumber.has(a.format("YYYY-MM-DD"))?this.daysBusySlotNumber.get(a.format("YYYY-MM-DD")):0;i++,this.daysBusySlotNumber.set(a.format("YYYY-MM-DD"),i)}this.busySlots.add(a.format("YYYY-MM-DDHH:mm"))}return t},L.prototype.buildingEarliestSlot=function(t){var e=t.clone().subtract(this.trueDuration,"minutes");e.minutes(e.minutes()-e.minutes()%this.slotDuration+this.slotDuration);for(var n=e.twix(t).iterate(this.slotDuration,"minutes");n.hasNext();){var o=L.splitRangeToNextTime(n,this.slotDuration),s=o.time;if(o.mmtTime,this.daysAvailability&&this.daysAvailability.has(s.format("YYYY-MM-DD"))&&!this.busySlots.has(s.format("YYYY-MM-DDHH:mm"))&&0<=this.daysAvailability.get(s.format("YYYY-MM-DD")).indexOf(s.format("HH:mm"))){var a=this.daysBusySlotNumber.has(s.format("YYYY-MM-DD"))?this.daysBusySlotNumber.get(s.format("YYYY-MM-DD")):0;a++,this.daysBusySlotNumber.set(s.format("YYYY-MM-DD"),a)}this.busySlots.add(s.format("YYYY-MM-DDHH:mm"))}},L.decorators=[{type:c.Component,args:[{selector:"ngx-calendar",template:'<mat-card class="week-calendar-wrapper">\n  <mat-card-header class="week-calendar-header">\n\n\n    <mat-card-title class="week-calendar-title">\n\n\n      <lib-calendar-header [start]="start"\n                           [end]="end"\n                           [viewMode]="viewMode"\n                           (switchedView)="onSwithedView($event)"\n                           (startChanged)="onStartChanged($event)"></lib-calendar-header>\n\n    </mat-card-title>\n\n\n  </mat-card-header>\n\n  <mat-card-content>\n\n\n    <lib-calendar-body [onlineSession]="onlineSession"\n                       [days]="days"\n                       [viewMode]="viewMode"\n                       [start]="start"\n                       [end]="end"\n                       [daysAvailability]="daysAvailability"\n                       [daysBusySlotNumber]="daysBusySlotNumber"\n                       [daysAvailabilitySlotNumber]="daysAvailabilitySlotNumber"\n                       [busySlots]="busySlots"\n                       [earlySlots]="earlySlots"\n                       [pauseSlots]="pauseSlots"\n                       [sessionsSlots]="sessionsSlots"\n                       [sessionsEndSlots]="sessionsEndSlots"\n                       [sessions]="sessions"\n                       (startChanged)="onStartChanged($event)"\n                       (sessionAdded)="onSessionAdded($event)"\n                       (sessionRemoved)="onSessionRemoved($event)"\n                       *ngIf="start && end && days && viewMode"></lib-calendar-body>\n\n  </mat-card-content>\n</mat-card>\n',styles:["@media (min-width:768px){.week-calendar-wrapper .week-calendar-header .week-calendar-title{width:90vw}}"]}]}],L.ctorParameters=function(){return[{type:k},{type:H},{type:c.ChangeDetectorRef},{type:c.Renderer2}]},L.propDecorators={onlineSession:[{type:c.Input}],start:[{type:c.Input}],end:[{type:c.Input}],slotDuration:[{type:c.Input}],viewModeChanged:[{type:c.Output}],sessionCreated:[{type:c.Output}],sessionRemoved:[{type:c.Output}],el:[{type:c.ViewChildren,args:["dayList"]}],viewMode:[{type:c.Input}]},L);function L(t,e,n,o){this.eventService=t,this.sessionService=e,this.cd=n,this.rd=o,this._viewMode="week",this.start=T(),this.end=T(),this.slotDuration=15,this.viewModeChanged=new c.EventEmitter,this.sessionCreated=new c.EventEmitter,this.sessionRemoved=new c.EventEmitter,this.days=[]}var q=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,s,a=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(o=a.next()).done;)i.push(o.value)}catch(r){s={error:r}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(s)throw s.error}}return i},R=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(q(arguments[e]));return t},V=(P.prototype.loadRouting=function(){var n=this;this.router.events.pipe(y.filter(function(t){return t instanceof d.NavigationEnd})).subscribe(function(t){var e=t.urlAfterRedirects;n.history=R(n.history,[e])})},P.prototype.getHistory=function(){return this.history},P.prototype.getPreviousUrl=function(){return this.history[this.history.length-2]||"/"},P.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],P.ctorParameters=function(){return[{type:d.Router}]},P.ngInjectableDef=c.ɵɵdefineInjectable({factory:function(){return new P(c.ɵɵinject(d.Router))},token:P,providedIn:"root"}),P);function P(t){this.router=t,this.history=[]}var $=new c.InjectionToken("event"),F=new c.InjectionToken("session"),G=(z.decorators=[{type:c.NgModule,args:[{imports:[e.CommonModule,n.FlexLayoutModule,o.MatTooltipModule,o.MatButtonModule,o.MatCardModule,o.MatTableModule,o.MatIconModule,s.TranslateModule.forChild()],declarations:[O,g,v],exports:[O,g,v],providers:[h,V,{provide:F,useValue:"session"},{provide:$,useValue:"event"},{provide:k,useClass:k,deps:[u.AngularFirestore,$]},{provide:H,useClass:H,deps:[u.AngularFirestore,F]}]}]}],z);function z(){}t.TABLE_EVENT=$,t.TABLE_SESSION=F,t.NgxCalendarModule=G,t.CalendarComponent=O,t.SessionService=H,t.EventService=k,t.ɵc=v,t.ɵb=g,t.ɵa=M,t.ɵd=h,t.ɵe=V,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=romainmarecat-ngx-calendar.umd.min.js.map