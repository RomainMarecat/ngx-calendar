!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@angular/flex-layout"),require("moment"),require("rxjs"),require("@angular/material/icon"),require("@angular/flex-layout/flex"),require("@angular/flex-layout/extended"),require("twix")):"function"==typeof define&&define.amd?define("@romainmarecat/ngx-calendar",["exports","@angular/common","@angular/core","@angular/flex-layout","moment","rxjs","@angular/material/icon","@angular/flex-layout/flex","@angular/flex-layout/extended","twix"],e):e(((t=t||self).romainmarecat=t.romainmarecat||{},t.romainmarecat["ngx-calendar"]={}),t.ng.common,t.ng.core,t.ng.flexLayout,t.moment,t.rxjs,t.ng.material.icon,t.ng.flexLayout.flex,t.ng.flexLayout.extended)}(this,(function(t,e,n,s,o,i,a,r,l){"use strict";var d;(d=t.EventType||(t.EventType={}))[d.absence=0]="absence",d[d.session=1]="session";var c=function(){function t(){this.sessionsEntries$=new i.BehaviorSubject([]),this.sessions=new i.BehaviorSubject(new Map)}return t.ɵfac=function(e){return new(e||t)},t.ɵprov=n["ɵɵdefineInjectable"]({token:t,factory:t.ɵfac,providedIn:"root"}),t}();function u(t,e){if(1&t&&(n["ɵɵelementStart"](0,"th",8),n["ɵɵelementStart"](1,"span",9),n["ɵɵtext"](2),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()),2&t){var s=e.$implicit;n["ɵɵadvance"](2),n["ɵɵtextInterpolate"](s.title)}}function m(t,e){if(1&t&&(n["ɵɵelementStart"](0,"tr",6),n["ɵɵtemplate"](1,u,3,1,"th",7),n["ɵɵelementEnd"]()),2&t){var s=n["ɵɵnextContext"]();n["ɵɵadvance"](1),n["ɵɵproperty"]("ngForOf",s.days)}}function y(t,e){if(1&t){var s=n["ɵɵgetCurrentView"]();n["ɵɵelementStart"](0,"button",20),n["ɵɵlistener"]("click",(function(){n["ɵɵrestoreView"](s);var t=n["ɵɵnextContext"]().$implicit,e=n["ɵɵnextContext"]().$implicit;return n["ɵɵnextContext"]().onTimeSlotClicked(e,t)})),n["ɵɵelementStart"](1,"span",21),n["ɵɵtext"](2),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()}if(2&t){var o=n["ɵɵnextContext"]().$implicit;n["ɵɵadvance"](2),n["ɵɵtextInterpolate"](o)}}function h(t,e){if(1&t&&(n["ɵɵelementStart"](0,"button",22),n["ɵɵtext"](1),n["ɵɵelementEnd"]()),2&t){var s=n["ɵɵnextContext"]().$implicit,o=n["ɵɵnextContext"]().$implicit,i=n["ɵɵnextContext"]();n["ɵɵadvance"](1),n["ɵɵtextInterpolate1"](" ",i.getSessionTitle(o,s)," ")}}function f(t,e){1&t&&(n["ɵɵelementStart"](0,"mat-icon",23),n["ɵɵtext"](1," close "),n["ɵɵelementEnd"]())}function p(t,e){if(1&t&&(n["ɵɵelementStart"](0,"div",24),n["ɵɵelementStart"](1,"span"),n["ɵɵtext"](2),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()),2&t){var s=n["ɵɵnextContext"](3);n["ɵɵadvance"](2),n["ɵɵtextInterpolate"](s.bodyConfiguration.calendar.availability.empty)}}function v(t,e){if(1&t){var s=n["ɵɵgetCurrentView"]();n["ɵɵelementStart"](0,"div",13),n["ɵɵelementStart"](1,"div",14),n["ɵɵtemplate"](2,y,3,1,"button",15),n["ɵɵtemplate"](3,h,2,1,"ng-template",null,16,n["ɵɵtemplateRefExtractor"]),n["ɵɵelementStart"](5,"a",17),n["ɵɵlistener"]("click",(function(){n["ɵɵrestoreView"](s);var t=e.$implicit,o=n["ɵɵnextContext"]().$implicit;return n["ɵɵnextContext"]().onTimeSlotClicked(o,t)})),n["ɵɵtemplate"](6,f,2,0,"mat-icon",18),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵtemplate"](7,p,3,1,"div",19),n["ɵɵelementEnd"]()}if(2&t){var o=e.$implicit,i=n["ɵɵreference"](4),a=n["ɵɵnextContext"]().$implicit,r=n["ɵɵnextContext"]();n["ɵɵclassProp"]("busy",r.isSlotBusy(a,o))("early",r.isSlotEarly(a,o))("session",r.isSlotInSession(a,o))("session-start",r.isSlotSessionStart(a,o))("session-end",r.isSlotSessionEnd(a,o)),n["ɵɵadvance"](2),n["ɵɵproperty"]("ngIf",!r.isDateTimeInSessionsFromCurrentUser(a,o))("ngIfElse",i),n["ɵɵadvance"](4),n["ɵɵproperty"]("ngIf",r.isDateTimeInSessionsFromCurrentUser(a,o)),n["ɵɵadvance"](1),n["ɵɵproperty"]("ngIf",r.getAvailabilities(a.key).length<=0||r.isDayBusy(a,o))}}function b(t,e){if(1&t){var s=n["ɵɵgetCurrentView"]();n["ɵɵelementStart"](0,"div",25),n["ɵɵelementStart"](1,"button",26),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"](2).onNextDay()})),n["ɵɵelementStart"](2,"span"),n["ɵɵtext"](3),n["ɵɵelementEnd"](),n["ɵɵelementStart"](4,"mat-icon"),n["ɵɵtext"](5,"keyboard_arrow_right"),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()}if(2&t){var o=n["ɵɵnextContext"](2);n["ɵɵadvance"](1),n["ɵɵproperty"]("title",o.bodyConfiguration.calendar.availability.slot),n["ɵɵadvance"](2),n["ɵɵtextInterpolate"](o.bodyConfiguration.calendar.availability.slot)}}function S(t,e){if(1&t&&(n["ɵɵelementStart"](0,"td",10),n["ɵɵtemplate"](1,v,8,14,"div",11),n["ɵɵtemplate"](2,b,6,2,"div",12),n["ɵɵelementEnd"]()),2&t){var s=e.$implicit,o=e.index,i=n["ɵɵnextContext"]();n["ɵɵattribute"]("id",s.key),n["ɵɵadvance"](1),n["ɵɵproperty"]("ngForOf",i.getAvailabilities(s.key)),n["ɵɵadvance"](1),n["ɵɵproperty"]("ngIf",i.isAllSlotNotAvailable()&&o===i.days.length-1)}}var g=o,x=function(){function s(t){this.sessionService=t,this.sessionAdded=new n.EventEmitter,this.sessionRemoved=new n.EventEmitter,this.startChanged=new n.EventEmitter,this.endChanged=new n.EventEmitter,this.slotLocked=new n.EventEmitter}return s.prototype.ngOnInit=function(){var t=this;this.sessionService.sessions.subscribe((function(e){t.sessions=e}))},s.prototype.onNextDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=g(this.start).add(t,"day"),this.startChanged.emit(this.start)},s.prototype.isAllSlotNotAvailable=function(){var t=this;if(this.days&&this.days.length>0)return 0===this.days.filter((function(e){return t.daysAvailability.get(e.key).length>0})).length},s.prototype.getAvailabilities=function(t){return this.daysAvailability.get(t)},s.prototype.getSessionTitle=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;if(this.sessions&&this.sessions.has(n)){var s=this.sessions.get(n);return g(s.start).format("HH:mm")+" - "+g(s.end).format("HH:mm")}return""},s.prototype.getSessionTooltip=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;if(this.sessions&&this.sessions.has(n)){var s=this.sessions.get(n);if(s.comment)return s.comment}return""},s.prototype.onTimeSlotClicked=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;if(this.isSlotBusy(t,e)||this.isSlotEarly(t,e))this.slotLocked.emit(!0);else if(this.isDateTimeInSessionsFromCurrentUser(t,e))if(this.sessions.has(n)){var s={key:n,session:this.sessions.get(n)};this.removeSession(s)}else;else{var o=g(n,"YYYY-MM-DDHH:mm"),i=o.clone().add(this.onlineSession.duration,"minutes");this.addSession(o,i)}},s.prototype.addSession=function(e,n){Date.prototype.toJSON=function(){return g(this).format()};var s={id:null,start:e.toDate(),end:n.toDate(),pause:this.onlineSession.pause||0,duration:this.onlineSession.duration,nb_persons:1,event_type:t.EventType.session,comment:this.bodyConfiguration.calendar.session.info,user:this.user,customers:[this.customer]};this.sessionAdded.emit(s)},s.prototype.removeSession=function(t){this.sessionRemoved.emit(t)},s.prototype.isDayBusy=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.daysBusySlotNumber&&this.daysAvailabilitySlotNumber&&this.daysBusySlotNumber.has(n)&&this.daysAvailabilitySlotNumber.has(n)&&this.daysBusySlotNumber.get(n)>=this.daysAvailabilitySlotNumber.get(n)},s.prototype.isSlotBusy=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.busySlots&&this.busySlots.has(n)},s.prototype.isSlotEarly=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.earlySlots&&this.earlySlots.has(n)||this.pauseSlots&&this.pauseSlots.has(n)},s.prototype.isSlotInSession=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.sessionsSlots&&this.sessionsSlots.has(n)},s.prototype.isDateTimeInSessionsFromCurrentUser=function(t,e){var n=t.value.format("YYYY-MM-DD")+e,s=this.sessions.get(n);return this.sessions&&this.sessions.has(n)&&this.sessionsSlots.has(n)&&this.sessionsSlots.has(g(s.end).format("YYYY-MM-DDHH:mm"))&&this.sessionsStartSlots.has(n)&&this.sessionsEndSlots.has(g(s.end).format("YYYY-MM-DDHH:mm"))},s.prototype.isSlotSessionStart=function(t,e){var n=t.value.format("YYYY-MM-DD")+e;return this.sessionsSlots&&this.sessionsSlots.has(n)&&this.sessionsStartSlots.has(n)},s.prototype.isSlotSessionEnd=function(t,e){var n=t.value.format("YYYY-MM-DD")+e,s=this.sessions.get(n);return this.sessionsSlots&&this.sessionsSlots.has(n)&&this.sessionsEndSlots.has(n)||this.sessionsStartSlots.has(n)&&s&&this.sessionsEndSlots.has(g(s.end).format("YYYY-MM-DDHH:mm"))},s.ɵfac=function(t){return new(t||s)(n["ɵɵdirectiveInject"](c))},s.ɵcmp=n["ɵɵdefineComponent"]({type:s,selectors:[["lib-calendar-body"]],inputs:{user:"user",customer:"customer",onlineSession:"onlineSession",viewMode:"viewMode",start:"start",end:"end",days:"days",daysAvailability:"daysAvailability",daysBusySlotNumber:"daysBusySlotNumber",daysAvailabilitySlotNumber:"daysAvailabilitySlotNumber",busySlots:"busySlots",earlySlots:"earlySlots",pauseSlots:"pauseSlots",sessionsSlots:"sessionsSlots",sessionsEndSlots:"sessionsEndSlots",sessionsStartSlots:"sessionsStartSlots",bodyConfiguration:"bodyConfiguration"},outputs:{sessionAdded:"sessionAdded",sessionRemoved:"sessionRemoved",startChanged:"startChanged",endChanged:"endChanged",slotLocked:"slotLocked"},decls:7,vars:2,consts:[[1,"calendar-body-wrapper"],[1,"calendar-body-table-wrapper","table","table-bordered"],[1,"calendar-body-table-head"],["class","calendar-body-head-day-row",4,"ngIf"],[1,"calendar-body-row"],["class","calendar-body-column-content text-center",4,"ngFor","ngForOf"],[1,"calendar-body-head-day-row"],["class","calendar-body-day-header text-center",4,"ngFor","ngForOf"],[1,"calendar-body-day-header","text-center"],[1,"truncate"],[1,"calendar-body-column-content","text-center"],["class","time-slot",3,"busy","early","session","session-start","session-end",4,"ngFor","ngForOf"],["class","next-slot",4,"ngIf"],[1,"time-slot"],[1,"time-content"],["type","button","class","slot-available",3,"click",4,"ngIf","ngIfElse"],["sessionTitle",""],[1,"link-close",3,"click"],["class","icon-close",4,"ngIf"],["class","slot-busy",4,"ngIf"],["type","button",1,"slot-available",3,"click"],[1,"default-time"],["type","button",1,"slot-session"],[1,"icon-close"],[1,"slot-busy"],[1,"next-slot"],["type","button","role","button",3,"title","click"]],template:function(t,e){1&t&&(n["ɵɵelementStart"](0,"div",0),n["ɵɵelementStart"](1,"table",1),n["ɵɵelementStart"](2,"thead",2),n["ɵɵtemplate"](3,m,2,1,"tr",3),n["ɵɵelementEnd"](),n["ɵɵelementStart"](4,"tbody"),n["ɵɵelementStart"](5,"tr",4),n["ɵɵtemplate"](6,S,3,3,"td",5),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()),2&t&&(n["ɵɵadvance"](3),n["ɵɵproperty"]("ngIf","day"!==e.viewMode),n["ɵɵadvance"](3),n["ɵɵproperty"]("ngForOf",e.days))},directives:[e.NgIf,e.NgForOf,a.MatIcon],styles:[".calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]{max-width:240px}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot[_ngcontent-%COMP%]{padding:5px}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);font-family:Lato,Roboto,sans-serif;font-size:14px;font-weight:500}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot[_ngcontent-%COMP%]   button.slot-available[_ngcontent-%COMP%]{cursor:pointer;width:120px}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot[_ngcontent-%COMP%]:hover   button.slot-available[_ngcontent-%COMP%]{background-color:#006400;color:#fff}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.busy[_ngcontent-%COMP%]{display:none}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.busy[_ngcontent-%COMP%]   button.slot-available[_ngcontent-%COMP%]{color:#8b0000;cursor:not-allowed}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.early[_ngcontent-%COMP%]   button.slot-available[_ngcontent-%COMP%]{cursor:not-allowed;color:orange}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session[_ngcontent-%COMP%]   .time-content[_ngcontent-%COMP%]{position:relative;padding:0}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session[_ngcontent-%COMP%]   .time-content[_ngcontent-%COMP%]   .slot-session[_ngcontent-%COMP%]{width:120px;background-color:#ff8c00}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session[_ngcontent-%COMP%]   .time-content[_ngcontent-%COMP%]   .link-close[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]{position:absolute;right:11px;top:4px;font-size:14px}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session[_ngcontent-%COMP%]   .time-content[_ngcontent-%COMP%]   .link-close[_ngcontent-%COMP%], .calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session[_ngcontent-%COMP%]   .time-content[_ngcontent-%COMP%]   .link-close[_ngcontent-%COMP%]:hover{cursor:pointer}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session-start[_ngcontent-%COMP%]{border-top-left-radius:3px;border-top-right-radius:3px}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session-start[_ngcontent-%COMP%]   .slot-session[_ngcontent-%COMP%]{color:#000;cursor:text}.calendar-body-wrapper[_ngcontent-%COMP%]   .calendar-body-column-content[_ngcontent-%COMP%]   .time-slot.session-end[_ngcontent-%COMP%]{border-bottom-left-radius:3px;border-bottom-right-radius:3px}"]}),s}();function M(t,e){if(1&t&&(n["ɵɵelementStart"](0,"span"),n["ɵɵtext"](1),n["ɵɵelementEnd"]()),2&t){var s=n["ɵɵnextContext"](2);n["ɵɵadvance"](1),n["ɵɵtextInterpolate1"](" - ",null==s.end?null:s.end.format("LL")," ")}}function Y(t,e){if(1&t){var s=n["ɵɵgetCurrentView"]();n["ɵɵelementStart"](0,"div",1),n["ɵɵelementStart"](1,"div",2),n["ɵɵelementStart"](2,"button",3),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().previousDay()})),n["ɵɵelementStart"](3,"mat-icon"),n["ɵɵtext"](4,"keyboard_arrow_left"),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](5,"button",3),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().nextDay()})),n["ɵɵelementStart"](6,"mat-icon"),n["ɵɵtext"](7,"keyboard_arrow_right"),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](8,"button",4),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().goToToday()})),n["ɵɵelementStart"](9,"mat-icon"),n["ɵɵtext"](10,"today"),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](11,"div",5),n["ɵɵelementStart"](12,"button",6),n["ɵɵelementStart"](13,"span"),n["ɵɵtext"](14),n["ɵɵelementEnd"](),n["ɵɵtemplate"](15,M,2,1,"span",7),n["ɵɵelementEnd"](),n["ɵɵelementStart"](16,"button",8),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().switchView("week")})),n["ɵɵelementStart"](17,"mat-icon"),n["ɵɵtext"](18,"view_week"),n["ɵɵelementEnd"](),n["ɵɵelementStart"](19,"span",9),n["ɵɵtext"](20),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](21,"button",8),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().switchView("three_days")})),n["ɵɵelementStart"](22,"mat-icon"),n["ɵɵtext"](23,"view_column"),n["ɵɵelementEnd"](),n["ɵɵelementStart"](24,"span",9),n["ɵɵtext"](25),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](26,"button",8),n["ɵɵlistener"]("click",(function(){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().switchView("day")})),n["ɵɵelementStart"](27,"mat-icon"),n["ɵɵtext"](28,"view_day"),n["ɵɵelementEnd"](),n["ɵɵelementStart"](29,"span",9),n["ɵɵtext"](30),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()}if(2&t){var o=n["ɵɵnextContext"]();n["ɵɵadvance"](2),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.cta.previous),n["ɵɵadvance"](3),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.cta.next),n["ɵɵadvance"](3),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.back_today)("disabled",o.isToday()),n["ɵɵadvance"](4),n["ɵɵclassProp"]("hide-on-small-only",(null==o.end?null:o.end.format("YYYY-MM-DD"))!==(null==o.start?null:o.start.format("YYYY-MM-DD"))),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.today)("disabled",!0),n["ɵɵadvance"](2),n["ɵɵtextInterpolate"](null==o.start?null:o.start.format("LL")),n["ɵɵadvance"](1),n["ɵɵproperty"]("ngIf",(null==o.end?null:o.end.format("YYYY-MM-DD"))!==(null==o.start?null:o.start.format("YYYY-MM-DD"))),n["ɵɵadvance"](1),n["ɵɵclassProp"]("active","week"===o.viewMode),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.week),n["ɵɵadvance"](4),n["ɵɵtextInterpolate"](o.headerConfiguration.calendar.week),n["ɵɵadvance"](1),n["ɵɵclassProp"]("active","three_days"===o.viewMode),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.three_days),n["ɵɵadvance"](4),n["ɵɵtextInterpolate"](o.headerConfiguration.calendar.three_days),n["ɵɵadvance"](1),n["ɵɵclassProp"]("active","day"===o.viewMode),n["ɵɵproperty"]("title",o.headerConfiguration.calendar.day),n["ɵɵadvance"](4),n["ɵɵtextInterpolate"](o.headerConfiguration.calendar.day)}}var w=o,C=function(){function t(){this.switchedView=new n.EventEmitter,this.startChanged=new n.EventEmitter}return Object.defineProperty(t.prototype,"viewMode",{get:function(){return this._viewMode},set:function(t){this.switchView(t)},enumerable:!0,configurable:!0}),t.prototype.switchView=function(t){this._viewMode=t,this.onSwitchedView(t)},t.prototype.onSwitchedView=function(t){this.switchedView.emit(t)},t.prototype.onStartChanged=function(t){this.startChanged.emit(t)},t.prototype.goToToday=function(){this.start=w(),this.onStartChanged(this.start)},t.prototype.isToday=function(){return w()===w(this.start)},t.prototype.previousDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=w(this.start).subtract(t,"day"),this.onStartChanged(this.start)},t.prototype.nextDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=w(this.start).add(t,"day"),this.onStartChanged(this.start)},t.ɵfac=function(e){return new(e||t)},t.ɵcmp=n["ɵɵdefineComponent"]({type:t,selectors:[["lib-calendar-header"]],inputs:{start:"start",end:"end",headerConfiguration:"headerConfiguration",viewMode:"viewMode"},outputs:{switchedView:"switchedView",startChanged:"startChanged"},decls:1,vars:1,consts:[["fxLayout","row wrap","fxLayoutAlign","start stretch","fxLayout.xs","column","fxLayoutAlign.xs","start center","fxLayoutGap.xs","10px",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","start stretch","fxLayout.xs","column","fxLayoutAlign.xs","start center","fxLayoutGap.xs","10px"],["fxLayout","row","fxLayoutAlign","start stretch","fxLayoutGap","10px","fxLayout.xs","row","fxLayoutAlign.xs","center stretch","fxLayoutGap.xs","10px",1,"left-actions"],["type","button","role","button",1,"button-actions",3,"title","click"],["role","button",1,"button-actions",3,"title","disabled","click"],["fxLayout","row wrap","fxLayoutAlign","end stretch","fxLayoutGap","10px","fxLayout.xs","row wrap","fxLayoutAlign.xs","center stretch","fxLayoutGap.xs","10px",1,"right-actions"],["type","button","role","button",1,"button-actions",3,"title","disabled"],[4,"ngIf"],["type","button","role","button","fxHide.lt-md","true",1,"button-actions",3,"title","click"],["fxHide.lt-md","true"]],template:function(t,e){1&t&&n["ɵɵtemplate"](0,Y,31,22,"div",0),2&t&&n["ɵɵproperty"]("ngIf",e.headerConfiguration)},directives:[e.NgIf,r.DefaultLayoutDirective,r.DefaultLayoutAlignDirective,r.DefaultLayoutGapDirective,a.MatIcon,l.DefaultShowHideDirective],styles:[".button-actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:5px}button[_ngcontent-%COMP%]{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:36px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);font-family:Lato,Roboto,sans-serif;font-size:14px;font-weight:500;display:-webkit-inline-box;display:inline-flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}"]}),t}();function D(t,e){if(1&t){var s=n["ɵɵgetCurrentView"]();n["ɵɵelementStart"](0,"lib-calendar-body",5),n["ɵɵlistener"]("startChanged",(function(t){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().onStartChanged(t)}))("sessionAdded",(function(t){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().onSessionAdded(t)}))("sessionRemoved",(function(t){return n["ɵɵrestoreView"](s),n["ɵɵnextContext"]().onSessionRemoved(t)})),n["ɵɵelementEnd"]()}if(2&t){var o=n["ɵɵnextContext"]();n["ɵɵproperty"]("bodyConfiguration",o.calendarConfiguration)("onlineSession",o.onlineSession)("days",o.days)("viewMode",o.viewMode)("start",o.start)("end",o.end)("daysAvailability",o.daysAvailability)("daysBusySlotNumber",o.daysBusySlotNumber)("daysAvailabilitySlotNumber",o.daysAvailabilitySlotNumber)("busySlots",o.busySlots)("user",o.user)("customer",o.customer)("earlySlots",o.earlySlots)("pauseSlots",o.pauseSlots)("sessionsSlots",o.sessionsSlots)("sessionsStartSlots",o.sessionsStartSlots)("sessionsEndSlots",o.sessionsEndSlots)}}var E=o,_=function(){function t(t,e){this.cd=t,this.sessionService=e,this.onlineSession={id:null,comment:"",name:"",max_persons:1,booking_delay:1,duration:15,pause:0,price:10,start_date:"2019-01-01",end_date:"2030-12-31",start_time:"08:00",end_time:"19:00"},this.start=E(),this.end=E(),this.calendarConfiguration={calendar:{cta:{next:"suivant",previous:"précédent"},today:"aujourd'hui",back_today:"revenir à la date d'aujourd'hui",day:"jour",three_days:"3 jours",week:"semaine",title:"réserver votre créneau",subtitle:"toutes les disponibilités",availability:{empty:"Aucune disponibilité",slot:"Prochaine disponibilité"},session:{info:"Créneau vérrouillé"}}},this.viewModeChanged=new n.EventEmitter,this.sessionCreated=new n.EventEmitter,this.sessionRemoved=new n.EventEmitter,this.days=[],this._sessionsEntries=[],this._viewMode="week"}return Object.defineProperty(t.prototype,"sessionsEntries",{get:function(){return this._sessionsEntries},set:function(t){t.length&&(this._sessionsEntries=t),this.loadCalendar()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewMode",{get:function(){return this._viewMode},set:function(t){this._viewMode=t,this.setViewMode()},enumerable:!0,configurable:!0}),t.splitRangeToNextTime=function(e,n){var s=e.next();return{time:s,mmtTime:t.getMinutesDifference(E(s.toDate()),n)}},t.getMinutesDifference=function(t,e){return t.minutes()%e!=0&&t.minutes(t.minutes()-t.minutes()%e),t},t.prototype.ngOnChanges=function(){this.loadCalendar()},t.prototype.setCalendar=function(){this.days=[],this.daysAvailability=new Map,this.sessionsSlots=new Set,this.sessionsEndSlots=new Set,this.sessionsStartSlots=new Set,this.earlySlots=new Set,this.pauseSlots=new Set,this.busySlots=new Set,this.daysBusySlotNumber=new Map,this.sessions=new Map,this.sessionService.sessions.next(this.sessions)},t.prototype.setViewMode=function(){if("day"===this.viewMode)return this.end=this.start,this.calendarStart=E(this.start).startOf("day"),void(this.calendarEnd=E(this.end).endOf("day"));if("three_days"===this.viewMode)return this.end=E(this.start).add(2,"days"),this.calendarStart=E(this.start).startOf("day"),void(this.calendarEnd=E(this.end).endOf("day"));this.start||(this.start=E()),this.start=E(this.start).day(0).startOf("day"),this.end=E(this.start).add(6,"days").endOf("day"),this.calendarStart=E(this.start).startOf("day"),this.calendarEnd=E(this.end).endOf("day")},t.prototype.loadCalendar=function(){this.setCalendar(),this.setViewMode(),this.setDateRange(this.start,this.end),this.loadEvents(this.start,this.end),this.loadAvailabilities()},t.prototype.setDateRange=function(t,e){for(var n=t.twix(e).iterate(1,"days");n.hasNext();){var s=n.next();this.days.push({title:s.format("DD/MM/YYYY"),key:s.format("YYYY-MM-DD"),value:E(s.toDate())}),this.daysAvailability.set(s.format("YYYY-MM-DD"),[])}},t.prototype.onSwithedView=function(t){this.viewMode=t,this.viewModeChanged.emit(t),this.loadCalendar()},t.prototype.onStartChanged=function(t){this.start=t,this.loadCalendar()},t.prototype.onSessionAdded=function(t){this.sessions.set(E(t.start).format("YYYY-MM-DDHH:mm"),t),this.sessionService.sessions.next(this.sessions),this.addSession(t),this.sessionCreated.emit(t)},t.prototype.onSessionRemoved=function(t){this.sessions.delete(t.key),this.sessionService.sessions.next(this.sessions),this.removeSession(t.session),this.sessionRemoved.emit(t.session)},t.prototype.loadAvailabilities=function(){var t=this;if(this.daysAvailability&&this.onlineSession){this.realDuration=this.onlineSession.duration;var e=E(this.onlineSession.start_date,"YYYY-MM-DD").startOf("day"),n=E(this.onlineSession.end_date,"YYYY-MM-DD").endOf("day");this.daysAvailabilitySlotNumber=new Map,this.daysAvailability.forEach((function(s,o){var i=0,a=E(o,"YYYY-MM-DD").hour(8),r=E(o+t.onlineSession.start_time,"YYYY-MMDDHH:mm");if(!r.isBefore(E().startOf("day"))){var l=E().add(t.onlineSession.booking_delay,"hours"),d=E(o+t.onlineSession.end_time,"YYYY-MM-DDHH:mm");d.subtract(t.realDuration,"minutes");var c=r.twix(d).iterate(t.onlineSession.duration,"minutes");if(t.calendarStart&&t.calendarEnd&&a.isBetween(e,n))for(;c.hasNext();){var u=c.next();E(u.toDate()).isBefore(l)||(s.push(u.format("HH:mm")),i++)}t.daysAvailabilitySlotNumber.set(o,i)}}))}},t.prototype.addSession=function(t){for(var e=E(t.start),n=E(t.end),s=e.twix(n).iterateInner(t.duration,"minutes");s.hasNext();){var o=s.next();this.sessionsSlots.add(o.format("YYYY-MM-DDHH:mm")),s.hasNext()?this.sessionsStartSlots.add(o.format("YYYY-MM-DDHH:mm")):this.sessionsEndSlots.add(o.format("YYYY-MM-DDHH:mm"))}var i=e.clone().subtract(this.realDuration,"minutes");i.minutes(i.minutes()-i.minutes()%t.duration+t.duration);var a=i.twix(e).iterate(t.duration,"minutes");this.handleEarlySlot(a,"add",t,i,e);var r=n.clone();r.subtract(r.minutes()%t.duration);var l=r.clone().add(t.pause,"minutes"),d=r.twix(l).iterate(t.duration,"minutes");this.handlePauseSlot(d,"add",t,i,r)},t.prototype.removeSession=function(t){for(var e=E(t.start),n=E(t.end),s=e.twix(n).iterate(t.duration,"minutes");s.hasNext();){var o=s.next();s.hasNext()?this.sessionsStartSlots.delete(o.format("YYYY-MM-DDHH:mm")):this.sessionsEndSlots.delete(o.format("YYYY-MM-DDHH:mm"))}var i=e.clone().subtract(this.realDuration,"minutes");i.minutes(i.minutes()-i.minutes()%t.duration+t.duration);var a=i.twix(e).iterate(t.duration,"minutes");if(this.handleEarlySlot(a,"remove",t,i,e),t.pause){var r=n.clone();r.subtract(r.minutes()%t.duration);var l=r.clone().add(t.pause,"minutes"),d=r.twix(l).iterate(t.duration,"minutes");this.handlePauseSlot(d,"remove",t,i,r)}},t.prototype.loadEvents=function(t,e){var n=this;this.onlineSession&&Array.isArray(this._sessionsEntries)&&this._sessionsEntries.length&&this._sessionsEntries.forEach((function(s){E(s.start).isSameOrAfter(t)&&E(s.end).isSameOrBefore(e)&&(n.buildinBusySlot(s),n.buildingEarliestSlot(s))}))},t.prototype.buildinBusySlot=function(e){var n=E(e.start,"YYYY-MM-DDHH:mm"),s=E(e.end,"YYYY-MM-DDHH:mm");if(!(n&&n.isValid()&&s&&s.isValid()&&n.isSameOrBefore(s)))return console.error("invalid dates",n,s),null;for(var o=n.twix(s).iterate(e.duration,"minutes");o.hasNext();){var i=t.splitRangeToNextTime(o,e.duration),a=i.time;i.mmtTime;this.daysAvailability&&this.daysAvailability.has(a.format("YYYY-MM-DD"))&&!this.busySlots.has(a.format("YYYY-MM-DDHH:mm"))&&!this.daysAvailability.get(a.format("YYYY-MM-DD")).includes(a.format("HH:mm"))&&((!e.customers||e.customers&&this.customer&&!e.customers.map((function(t){return t.id})).includes(this.customer.id))&&this.addDayBusySlot(a),e.customers&&this.customer&&e.customers.map((function(t){return t.id})).includes(this.customer.id)&&this.setSessionSlot(o,a,e))}return this.sessionService.sessions.next(this.sessions),n},t.prototype.setSessionSlot=function(t,e,n){this.sessionsSlots.add(e.format("YYYY-MM-DDHH:mm")),t.hasNext()?(this.sessions.set(e.format("YYYY-MM-DDHH:mm"),n),this.sessionsStartSlots.add(e.format("YYYY-MM-DDHH:mm"))):this.sessionsEndSlots.add(e.format("YYYY-MM-DDHH:mm"))},t.prototype.buildingEarliestSlot=function(e){var n=E(e.start,"YYYY-MM-DDHH:mm");if(n&&this.realDuration){var s=n.clone().subtract(this.realDuration,"minutes");s.minutes(s.minutes()-s.minutes()%this.onlineSession.duration+this.onlineSession.duration);for(var o=s.twix(n).iterate(this.onlineSession.duration,"minutes");o.hasNext();){var i=t.splitRangeToNextTime(o,this.onlineSession.duration),a=i.time;i.mmtTime;this.daysAvailability&&this.daysAvailability.has(a.format("YYYY-MM-DD"))&&!this.busySlots.has(a.format("YYYY-MM-DDHH:mm"))&&this.daysAvailability.get(a.format("YYYY-MM-DD")).includes(a.format("HH:mm"))&&this.addDayBusySlot(a)}}},t.prototype.addDayBusySlot=function(t){var e=this.daysBusySlotNumber.has(t.format("YYYY-MM-DD"))?this.daysBusySlotNumber.get(t.format("YYYY-MM-DD")):0;e++,this.daysBusySlotNumber.set(t.format("YYYY-MM-DD"),e),this.busySlots.add(t.format("YYYY-MM-DDHH:mm"))},t.prototype.handlePauseSlot=function(e,n,s,o,i){for(;e.hasNext();){var a=e.next(),r=t.getMinutesDifference(E(a.toDate()),s.duration);r.isSameOrAfter(o)&&r.isBefore(i)&&("remove"===n&&this.pauseSlots.delete(r.format("YYYY-MM-DDHH:mm")),"add"===n&&this.pauseSlots.add(r.format("YYYY-MM-DDHH:mm")))}},t.prototype.handleEarlySlot=function(e,n,s,o,i){for(;e.hasNext();){var a=e.next(),r=t.getMinutesDifference(E(a.toDate()),s.duration);r.isSameOrAfter(o)&&r.isBefore(i)&&("add"===n&&this.earlySlots.add(r.format("YYYY-MM-DDHH:mm")),"remove"===n&&this.earlySlots.delete(r.format("YYYY-MM-DDHH:mm")))}},t.ɵfac=function(e){return new(e||t)(n["ɵɵdirectiveInject"](n.ChangeDetectorRef),n["ɵɵdirectiveInject"](c))},t.ɵcmp=n["ɵɵdefineComponent"]({type:t,selectors:[["ngx-calendar"]],inputs:{user:"user",customer:"customer",onlineSession:"onlineSession",start:"start",end:"end",calendarConfiguration:"calendarConfiguration",sessionsEntries:"sessionsEntries",viewMode:"viewMode"},outputs:{viewModeChanged:"viewModeChanged",sessionCreated:"sessionCreated",sessionRemoved:"sessionRemoved"},features:[n["ɵɵNgOnChangesFeature"]],decls:6,vars:5,consts:[[1,"week-calendar-wrapper"],[1,"week-calendar-header"],[1,"week-calendar-title"],[3,"start","end","headerConfiguration","viewMode","switchedView","startChanged"],[3,"bodyConfiguration","onlineSession","days","viewMode","start","end","daysAvailability","daysBusySlotNumber","daysAvailabilitySlotNumber","busySlots","user","customer","earlySlots","pauseSlots","sessionsSlots","sessionsStartSlots","sessionsEndSlots","startChanged","sessionAdded","sessionRemoved",4,"ngIf"],[3,"bodyConfiguration","onlineSession","days","viewMode","start","end","daysAvailability","daysBusySlotNumber","daysAvailabilitySlotNumber","busySlots","user","customer","earlySlots","pauseSlots","sessionsSlots","sessionsStartSlots","sessionsEndSlots","startChanged","sessionAdded","sessionRemoved"]],template:function(t,e){1&t&&(n["ɵɵelementStart"](0,"div",0),n["ɵɵelementStart"](1,"div",1),n["ɵɵelementStart"](2,"div",2),n["ɵɵelementStart"](3,"lib-calendar-header",3),n["ɵɵlistener"]("switchedView",(function(t){return e.onSwithedView(t)}))("startChanged",(function(t){return e.onStartChanged(t)})),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](4,"div"),n["ɵɵtemplate"](5,D,1,17,"lib-calendar-body",4),n["ɵɵelementEnd"](),n["ɵɵelementEnd"]()),2&t&&(n["ɵɵadvance"](3),n["ɵɵproperty"]("start",e.start)("end",e.end)("headerConfiguration",e.calendarConfiguration)("viewMode",e.viewMode),n["ɵɵadvance"](2),n["ɵɵproperty"]("ngIf",e.start&&e.end&&e.days&&e.viewMode))},directives:[C,e.NgIf,x],styles:[".week-calendar-wrapper[_ngcontent-%COMP%]   .week-calendar-header[_ngcontent-%COMP%]{padding-bottom:20px}"]}),t}(),O=function(){function t(){}return t.ɵmod=n["ɵɵdefineNgModule"]({type:t}),t.ɵinj=n["ɵɵdefineInjector"]({factory:function(e){return new(e||t)},imports:[[e.CommonModule,s.FlexLayoutModule,a.MatIconModule]]}),t}();("undefined"==typeof ngJitMode||ngJitMode)&&n["ɵɵsetNgModuleScope"](O,{declarations:[_,C,x],imports:[e.CommonModule,s.FlexLayoutModule,a.MatIconModule],exports:[_,C,x]}),t.CalendarBodyComponent=x,t.CalendarComponent=_,t.CalendarHeaderComponent=C,t.NgxCalendarModule=O,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=romainmarecat-ngx-calendar.umd.min.js.map