!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@angular/flex-layout"),require("@angular/material"),require("moment"),require("rxjs"),require("twix")):"function"==typeof define&&define.amd?define("@romainmarecat/ngx-calendar",["exports","@angular/common","@angular/core","@angular/flex-layout","@angular/material","moment","rxjs","twix"],e):e(((t=t||self).romainmarecat=t.romainmarecat||{},t.romainmarecat["ngx-calendar"]={}),t.ng.common,t.ng.core,t.ng["flex-layout"],t.ng.material,t.moment,t.rxjs)}(this,(function(t,e,s,n,i,o,a){"use strict";var r={absence:0,session:1};r[r.absence]="absence",r[r.session]="session";var d=function(){function t(){this.sessionsEntries$=new a.BehaviorSubject([]),this.sessions=new a.BehaviorSubject(new Map)}return t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=s.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var l=o,u=function(){function t(t){this.sessionService=t,this.sessionAdded=new s.EventEmitter,this.sessionRemoved=new s.EventEmitter,this.startChanged=new s.EventEmitter,this.endChanged=new s.EventEmitter,this.slotLocked=new s.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;this.sessionService.sessions.subscribe((function(e){t.sessions=e}))},t.prototype.onNextDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=l(this.start).add(t,"day"),this.startChanged.emit(this.start)},t.prototype.isAllSlotNotAvailable=function(){var t=this;if(this.days&&this.days.length>0)return 0===this.days.filter((function(e){return t.daysAvailability.get(e.key).length>0})).length},t.prototype.getAvailabilities=function(t){return this.daysAvailability.get(t)},t.prototype.getSessionTitle=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;if(this.sessions&&this.sessions.has(s)){var n=this.sessions.get(s);return l(n.start).format("HH:mm")+" - "+l(n.end).format("HH:mm")}return""},t.prototype.getSessionTooltip=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;if(this.sessions&&this.sessions.has(s)){var n=this.sessions.get(s);if(n.comment)return n.comment}return""},t.prototype.onTimeSlotClicked=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;if(this.isSlotBusy(t,e)||this.isSlotEarly(t,e))this.slotLocked.emit(!0);else if(this.isDateTimeInSessionsFromCurrentUser(t,e))if(this.sessions.has(s)){var n={key:s,session:this.sessions.get(s)};this.removeSession(n)}else;else{var i=l(s,"YYYY-MM-DDHH:mm"),o=i.clone().add(this.onlineSession.duration,"minutes");this.addSession(i,o)}},t.prototype.addSession=function(t,e){Date.prototype.toJSON=function(){return l(this).format()};var s={id:null,start:t.toDate(),end:e.toDate(),pause:this.onlineSession.pause||0,duration:this.onlineSession.duration,nb_persons:1,event_type:r.session,comment:this.bodyConfiguration.calendar.session.info,user:this.user,customers:[this.customer]};this.sessionAdded.emit(s)},t.prototype.removeSession=function(t){this.sessionRemoved.emit(t)},t.prototype.isDayBusy=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;return this.daysBusySlotNumber&&this.daysAvailabilitySlotNumber&&this.daysBusySlotNumber.has(s)&&this.daysAvailabilitySlotNumber.has(s)&&this.daysBusySlotNumber.get(s)>=this.daysAvailabilitySlotNumber.get(s)},t.prototype.isSlotBusy=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;return this.busySlots&&this.busySlots.has(s)},t.prototype.isSlotEarly=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;return this.earlySlots&&this.earlySlots.has(s)||this.pauseSlots&&this.pauseSlots.has(s)},t.prototype.isSlotInSession=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;return this.sessionsSlots&&this.sessionsSlots.has(s)},t.prototype.isDateTimeInSessionsFromCurrentUser=function(t,e){var s=t.value.format("YYYY-MM-DD")+e,n=this.sessions.get(s);return this.sessions&&this.sessions.has(s)&&this.sessionsSlots.has(s)&&this.sessionsSlots.has(l(n.end).format("YYYY-MM-DDHH:mm"))&&this.sessionsStartSlots.has(s)&&this.sessionsEndSlots.has(l(n.end).format("YYYY-MM-DDHH:mm"))},t.prototype.isSlotSessionStart=function(t,e){var s=t.value.format("YYYY-MM-DD")+e;return this.sessionsSlots&&this.sessionsSlots.has(s)&&this.sessionsStartSlots.has(s)},t.prototype.isSlotSessionEnd=function(t,e){var s=t.value.format("YYYY-MM-DD")+e,n=this.sessions.get(s);return this.sessionsSlots&&this.sessionsSlots.has(s)&&this.sessionsEndSlots.has(s)||this.sessionsStartSlots.has(s)&&n&&this.sessionsEndSlots.has(l(n.end).format("YYYY-MM-DDHH:mm"))},t.decorators=[{type:s.Component,args:[{selector:"lib-calendar-body",template:'<div class="calendar-body-wrapper">\n  <table class="calendar-body-table-wrapper table table-bordered">\n    <thead class="calendar-body-table-head">\n    <tr class="calendar-body-head-day-row"\n        *ngIf="viewMode !== \'day\'">\n      <th class="calendar-body-day-header text-center"\n          *ngFor="let day of days">\n        <span class="truncate">{{ day.title }}</span>\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr class="calendar-body-row">\n      <td class="calendar-body-column-content text-center"\n          [attr.id]="day.key"\n          *ngFor="let day of days; let keyDay = index">\n        <div class="time-slot"\n             [class.busy]="isSlotBusy(day, time)"\n             [class.early]="isSlotEarly(day, time)"\n             [class.session]="isSlotInSession(day, time)"\n             [class.session-start]="isSlotSessionStart(day, time)"\n             [class.session-end]="isSlotSessionEnd(day, time)"\n             *ngFor="let time of getAvailabilities(day.key)">\n          <div class="time-content">\n            <button type="button"\n                    class="slot-available"\n                    (click)="onTimeSlotClicked(day, time)"\n                    *ngIf="!isDateTimeInSessionsFromCurrentUser(day, time); else sessionTitle">\n              <span class="default-time">{{ time }}</span>\n            </button>\n            <ng-template #sessionTitle>\n              <button type="button"\n                      class="slot-session">\n                {{ getSessionTitle(day, time)}}\n              </button>\n            </ng-template>\n            <a class="link-close" (click)="onTimeSlotClicked(day, time)">\n              <mat-icon class="icon-close"\n                        *ngIf="isDateTimeInSessionsFromCurrentUser(day, time)">\n                close\n              </mat-icon>\n            </a>\n          </div>\n          <div class="slot-busy"\n               *ngIf="getAvailabilities(day.key).length <= 0 || isDayBusy(day, time)">\n            <span>{{bodyConfiguration.calendar.availability.empty}}</span>\n          </div>\n        </div>\n        <div class="next-slot"\n             *ngIf="isAllSlotNotAvailable() && keyDay === days.length-1">\n          <button type="button"\n                  role="button"\n                  [title]="bodyConfiguration.calendar.availability.slot"\n                  (click)="onNextDay()">\n            <span>{{ bodyConfiguration.calendar.availability.slot }}</span>\n            <mat-icon>keyboard_arrow_right</mat-icon>\n          </button>\n        </div>\n      </td>\n    </tr>\n    </tbody>\n  </table>\n</div>\n',styles:[".calendar-body-wrapper .calendar-body-column-content{max-width:240px}.calendar-body-wrapper .calendar-body-column-content .time-slot{padding:5px}.calendar-body-wrapper .calendar-body-column-content .time-slot button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);font-family:Lato,Roboto,sans-serif;font-size:14px;font-weight:500}.calendar-body-wrapper .calendar-body-column-content .time-slot button.slot-available{cursor:pointer;width:120px}.calendar-body-wrapper .calendar-body-column-content .time-slot:hover button.slot-available{background-color:#006400;color:#fff}.calendar-body-wrapper .calendar-body-column-content .time-slot.busy{display:none}.calendar-body-wrapper .calendar-body-column-content .time-slot.busy button.slot-available{color:#8b0000;cursor:not-allowed}.calendar-body-wrapper .calendar-body-column-content .time-slot.early button.slot-available{cursor:not-allowed;color:orange}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content{position:relative;padding:0}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .slot-session{width:120px;background-color:#ff8c00}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .link-close .icon-close{position:absolute;right:11px;top:4px;font-size:14px}.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .link-close,.calendar-body-wrapper .calendar-body-column-content .time-slot.session .time-content .link-close:hover{cursor:pointer}.calendar-body-wrapper .calendar-body-column-content .time-slot.session-start{border-top-left-radius:3px;border-top-right-radius:3px}.calendar-body-wrapper .calendar-body-column-content .time-slot.session-start .slot-session{color:#000;cursor:text}.calendar-body-wrapper .calendar-body-column-content .time-slot.session-end{border-bottom-left-radius:3px;border-bottom-right-radius:3px}"]}]}],t.ctorParameters=function(){return[{type:d}]},t.propDecorators={user:[{type:s.Input}],customer:[{type:s.Input}],onlineSession:[{type:s.Input}],viewMode:[{type:s.Input}],start:[{type:s.Input}],end:[{type:s.Input}],days:[{type:s.Input}],daysAvailability:[{type:s.Input}],daysBusySlotNumber:[{type:s.Input}],daysAvailabilitySlotNumber:[{type:s.Input}],busySlots:[{type:s.Input}],earlySlots:[{type:s.Input}],pauseSlots:[{type:s.Input}],sessionsSlots:[{type:s.Input}],sessionsEndSlots:[{type:s.Input}],sessionsStartSlots:[{type:s.Input}],bodyConfiguration:[{type:s.Input}],sessionAdded:[{type:s.Output}],sessionRemoved:[{type:s.Output}],startChanged:[{type:s.Output}],endChanged:[{type:s.Output}],slotLocked:[{type:s.Output}]},t}();var c=o,m=function(){function t(){this.switchedView=new s.EventEmitter,this.startChanged=new s.EventEmitter}return Object.defineProperty(t.prototype,"viewMode",{get:function(){return this._viewMode},set:function(t){this.switchView(t)},enumerable:!0,configurable:!0}),t.prototype.switchView=function(t){this._viewMode=t,this.onSwitchedView(t)},t.prototype.onSwitchedView=function(t){this.switchedView.emit(t)},t.prototype.onStartChanged=function(t){this.startChanged.emit(t)},t.prototype.goToToday=function(){this.start=c(),this.onStartChanged(this.start)},t.prototype.isToday=function(){return c()===c(this.start)},t.prototype.previousDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=c(this.start).subtract(t,"day"),this.onStartChanged(this.start)},t.prototype.nextDay=function(){var t=1;"week"===this.viewMode&&(t=7),this.start=c(this.start).add(t,"day"),this.onStartChanged(this.start)},t.decorators=[{type:s.Component,args:[{selector:"lib-calendar-header",template:'<div fxLayout="row wrap"\n     fxLayoutAlign="start stretch"\n     fxLayout.xs="column"\n     fxLayoutAlign.xs="start center"\n     fxLayoutGap.xs="10px"\n     *ngIf="headerConfiguration">\n\n  <div class="left-actions"\n       fxLayout="row"\n       fxLayoutAlign="start stretch"\n       fxLayoutGap="10px"\n       fxLayout.xs="row"\n       fxLayoutAlign.xs="center stretch"\n       fxLayoutGap.xs="10px">\n    <button class="button-actions"\n            (click)="previousDay()"\n            type="button"\n            role="button"\n            [title]="headerConfiguration.calendar.cta.previous">\n      <mat-icon>keyboard_arrow_left</mat-icon>\n    </button>\n    <button class="button-actions"\n            (click)="nextDay()"\n            type="button"\n            role="button"\n            [title]="headerConfiguration.calendar.cta.next">\n      <mat-icon>keyboard_arrow_right</mat-icon>\n    </button>\n    <button class="button-actions"\n            [title]="headerConfiguration.calendar.back_today"\n            [disabled]="isToday()"\n            (click)="goToToday()"\n            role="button">\n      <mat-icon>today</mat-icon>\n    </button>\n  </div>\n  <div class="right-actions"\n       fxLayout="row wrap"\n       fxLayoutAlign="end stretch"\n       fxLayoutGap="10px"\n       fxLayout.xs="row wrap"\n       fxLayoutAlign.xs="center stretch"\n       fxLayoutGap.xs="10px">\n    <button class="button-actions"\n            type="button"\n            role="button"\n            [title]="headerConfiguration.calendar.today"\n            [disabled]="true"\n            [class.hide-on-small-only]="end?.format(\'YYYY-MM-DD\') !== start?.format(\'YYYY-MM-DD\')">\n      <span>{{ start?.format(\'LL\') }}</span>\n      <span *ngIf="end?.format(\'YYYY-MM-DD\') !== start?.format(\'YYYY-MM-DD\')">\n        - {{ end?.format(\'LL\') }}\n      </span>\n    </button>\n    <button class="button-actions"\n            type="button"\n            role="button"\n            [title]="headerConfiguration.calendar.week"\n            [class.active]="viewMode === \'week\'"\n            (click)="switchView(\'week\')"\n            fxHide.lt-md="true">\n      <mat-icon>view_week</mat-icon>\n      <span fxHide.lt-md="true">{{ headerConfiguration.calendar.week }}</span>\n    </button>\n    <button class="button-actions"\n            type="button"\n            role="button"\n            [title]="headerConfiguration.calendar.three_days"\n            [class.active]="viewMode === \'three_days\'"\n            (click)="switchView(\'three_days\')"\n            fxHide.lt-md="true">\n      <mat-icon>view_column</mat-icon>\n      <span fxHide.lt-md="true">{{ headerConfiguration.calendar.three_days }}</span>\n    </button>\n    <button class="button-actions"\n            type="button"\n            role="button"\n            [title]="headerConfiguration.calendar.day"\n            [class.active]="viewMode === \'day\'"\n            (click)="switchView(\'day\')"\n            fxHide.lt-md="true">\n      <mat-icon>view_day</mat-icon>\n      <span fxHide.lt-md="true">{{ headerConfiguration.calendar.day }}</span>\n    </button>\n  </div>\n</div>\n',styles:[".button-actions span{margin-left:5px}button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:36px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);font-family:Lato,Roboto,sans-serif;font-size:14px;font-weight:500;display:inline-flex;align-items:center;justify-content:center}"]}]}],t.propDecorators={start:[{type:s.Input}],end:[{type:s.Input}],switchedView:[{type:s.Output}],startChanged:[{type:s.Output}],headerConfiguration:[{type:s.Input}],viewMode:[{type:s.Input}]},t}();var y=o,h=function(){function t(t,e){this.cd=t,this.sessionService=e,this.onlineSession={id:null,comment:"",name:"",max_persons:1,booking_delay:1,duration:15,pause:0,price:10,start_date:"2019-01-01",end_date:"2030-12-31",start_time:"08:00",end_time:"19:00"},this.start=y(),this.end=y(),this.calendarConfiguration={calendar:{cta:{next:"suivant",previous:"précédent"},today:"aujourd'hui",back_today:"revenir à la date d'aujourd'hui",day:"jour",three_days:"3 jours",week:"semaine",title:"réserver votre créneau",subtitle:"toutes les disponibilités",availability:{empty:"Aucune disponibilité",slot:"Prochaine disponibilité"},session:{info:"Créneau vérrouillé"}}},this.viewModeChanged=new s.EventEmitter,this.sessionCreated=new s.EventEmitter,this.sessionRemoved=new s.EventEmitter,this.days=[],this._sessionsEntries=[],this._viewMode="week"}return Object.defineProperty(t.prototype,"sessionsEntries",{get:function(){return this._sessionsEntries},set:function(t){t.length&&(this._sessionsEntries=t),this.loadCalendar()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewMode",{get:function(){return this._viewMode},set:function(t){this._viewMode=t,this.setViewMode()},enumerable:!0,configurable:!0}),t.splitRangeToNextTime=function(e,s){var n=e.next();return{time:n,mmtTime:t.getMinutesDifference(y(n.toDate()),s)}},t.getMinutesDifference=function(t,e){return t.minutes()%e!=0&&t.minutes(t.minutes()-t.minutes()%e),t},t.prototype.ngOnChanges=function(){this.loadCalendar()},t.prototype.setCalendar=function(){this.days=[],this.daysAvailability=new Map,this.sessionsSlots=new Set,this.sessionsEndSlots=new Set,this.sessionsStartSlots=new Set,this.earlySlots=new Set,this.pauseSlots=new Set,this.busySlots=new Set,this.daysBusySlotNumber=new Map,this.sessions=new Map,this.sessionService.sessions.next(this.sessions)},t.prototype.setViewMode=function(){if("day"===this.viewMode)return this.end=this.start,this.calendarStart=y(this.start).startOf("day"),void(this.calendarEnd=y(this.end).endOf("day"));if("three_days"===this.viewMode)return this.end=y(this.start).add(2,"days"),this.calendarStart=y(this.start).startOf("day"),void(this.calendarEnd=y(this.end).endOf("day"));this.start||(this.start=y()),this.start=y(this.start).day(0).startOf("day"),this.end=y(this.start).add(6,"days").endOf("day"),this.calendarStart=y(this.start).startOf("day"),this.calendarEnd=y(this.end).endOf("day")},t.prototype.loadCalendar=function(){this.setCalendar(),this.setViewMode(),this.setDateRange(this.start,this.end),this.loadEvents(this.start,this.end),this.loadAvailabilities()},t.prototype.setDateRange=function(t,e){for(var s=t.twix(e).iterate(1,"days");s.hasNext();){var n=s.next();this.days.push({title:n.format("DD/MM/YYYY"),key:n.format("YYYY-MM-DD"),value:y(n.toDate())}),this.daysAvailability.set(n.format("YYYY-MM-DD"),[])}},t.prototype.onSwithedView=function(t){this.viewMode=t,this.viewModeChanged.emit(t),this.loadCalendar()},t.prototype.onStartChanged=function(t){this.start=t,this.loadCalendar()},t.prototype.onSessionAdded=function(t){this.sessions.set(y(t.start).format("YYYY-MM-DDHH:mm"),t),this.sessionService.sessions.next(this.sessions),this.addSession(t),this.sessionCreated.emit(t)},t.prototype.onSessionRemoved=function(t){this.sessions.delete(t.key),this.sessionService.sessions.next(this.sessions),this.removeSession(t.session),this.sessionRemoved.emit(t.session)},t.prototype.loadAvailabilities=function(){var t=this;if(this.daysAvailability&&this.onlineSession){this.realDuration=this.onlineSession.duration;var e=y(this.onlineSession.start_date,"YYYY-MM-DD").startOf("day"),s=y(this.onlineSession.end_date,"YYYY-MM-DD").endOf("day");this.daysAvailabilitySlotNumber=new Map,this.daysAvailability.forEach((function(n,i){var o=0,a=y(i,"YYYY-MM-DD").hour(8),r=y(i+t.onlineSession.start_time,"YYYY-MMDDHH:mm");if(!r.isBefore(y().startOf("day"))){var d=y().add(t.onlineSession.booking_delay,"hours"),l=y(i+t.onlineSession.end_time,"YYYY-MM-DDHH:mm");l.subtract(t.realDuration,"minutes");var u=r.twix(l).iterate(t.onlineSession.duration,"minutes");if(t.calendarStart&&t.calendarEnd&&a.isBetween(e,s))for(;u.hasNext();){var c=u.next();y(c.toDate()).isBefore(d)||(n.push(c.format("HH:mm")),o++)}t.daysAvailabilitySlotNumber.set(i,o)}}))}},t.prototype.addSession=function(t){for(var e=y(t.start),s=y(t.end),n=e.twix(s).iterateInner(t.duration,"minutes");n.hasNext();){var i=n.next();this.sessionsSlots.add(i.format("YYYY-MM-DDHH:mm")),n.hasNext()?this.sessionsStartSlots.add(i.format("YYYY-MM-DDHH:mm")):this.sessionsEndSlots.add(i.format("YYYY-MM-DDHH:mm"))}var o=e.clone().subtract(this.realDuration,"minutes");o.minutes(o.minutes()-o.minutes()%t.duration+t.duration);var a=o.twix(e).iterate(t.duration,"minutes");this.handleEarlySlot(a,"add",t,o,e);var r=s.clone();r.subtract(r.minutes()%t.duration);var d=r.clone().add(t.pause,"minutes"),l=r.twix(d).iterate(t.duration,"minutes");this.handlePauseSlot(l,"add",t,o,r)},t.prototype.removeSession=function(t){for(var e=y(t.start),s=y(t.end),n=e.twix(s).iterate(t.duration,"minutes");n.hasNext();){var i=n.next();n.hasNext()?this.sessionsStartSlots.delete(i.format("YYYY-MM-DDHH:mm")):this.sessionsEndSlots.delete(i.format("YYYY-MM-DDHH:mm"))}var o=e.clone().subtract(this.realDuration,"minutes");o.minutes(o.minutes()-o.minutes()%t.duration+t.duration);var a=o.twix(e).iterate(t.duration,"minutes");if(this.handleEarlySlot(a,"remove",t,o,e),t.pause){var r=s.clone();r.subtract(r.minutes()%t.duration);var d=r.clone().add(t.pause,"minutes"),l=r.twix(d).iterate(t.duration,"minutes");this.handlePauseSlot(l,"remove",t,o,r)}},t.prototype.loadEvents=function(t,e){var s=this;this.onlineSession&&Array.isArray(this._sessionsEntries)&&this._sessionsEntries.length&&this._sessionsEntries.forEach((function(n){y(n.start).isSameOrAfter(t)&&y(n.end).isSameOrBefore(e)&&(s.buildinBusySlot(n),s.buildingEarliestSlot(n))}))},t.prototype.buildinBusySlot=function(e){var s=y(e.start,"YYYY-MM-DDHH:mm"),n=y(e.end,"YYYY-MM-DDHH:mm");if(!(s&&s.isValid()&&n&&n.isValid()&&s.isSameOrBefore(n)))return console.error("invalid dates",s,n),null;for(var i=s.twix(n).iterate(e.duration,"minutes");i.hasNext();){var o=t.splitRangeToNextTime(i,e.duration),a=o.time;o.mmtTime;this.daysAvailability&&this.daysAvailability.has(a.format("YYYY-MM-DD"))&&!this.busySlots.has(a.format("YYYY-MM-DDHH:mm"))&&!this.daysAvailability.get(a.format("YYYY-MM-DD")).includes(a.format("HH:mm"))&&((!e.customers||e.customers&&this.customer&&!e.customers.map((function(t){return t.id})).includes(this.customer.id))&&this.addDayBusySlot(a),e.customers&&this.customer&&e.customers.map((function(t){return t.id})).includes(this.customer.id)&&this.setSessionSlot(i,a,e))}return this.sessionService.sessions.next(this.sessions),s},t.prototype.setSessionSlot=function(t,e,s){this.sessionsSlots.add(e.format("YYYY-MM-DDHH:mm")),t.hasNext()?(this.sessions.set(e.format("YYYY-MM-DDHH:mm"),s),this.sessionsStartSlots.add(e.format("YYYY-MM-DDHH:mm"))):this.sessionsEndSlots.add(e.format("YYYY-MM-DDHH:mm"))},t.prototype.buildingEarliestSlot=function(e){var s=y(e.start,"YYYY-MM-DDHH:mm");if(s&&this.realDuration){var n=s.clone().subtract(this.realDuration,"minutes");n.minutes(n.minutes()-n.minutes()%this.onlineSession.duration+this.onlineSession.duration);for(var i=n.twix(s).iterate(this.onlineSession.duration,"minutes");i.hasNext();){var o=t.splitRangeToNextTime(i,this.onlineSession.duration),a=o.time;o.mmtTime;this.daysAvailability&&this.daysAvailability.has(a.format("YYYY-MM-DD"))&&!this.busySlots.has(a.format("YYYY-MM-DDHH:mm"))&&this.daysAvailability.get(a.format("YYYY-MM-DD")).includes(a.format("HH:mm"))&&this.addDayBusySlot(a)}}},t.prototype.addDayBusySlot=function(t){var e=this.daysBusySlotNumber.has(t.format("YYYY-MM-DD"))?this.daysBusySlotNumber.get(t.format("YYYY-MM-DD")):0;e++,this.daysBusySlotNumber.set(t.format("YYYY-MM-DD"),e),this.busySlots.add(t.format("YYYY-MM-DDHH:mm"))},t.prototype.handlePauseSlot=function(e,s,n,i,o){for(;e.hasNext();){var a=e.next(),r=t.getMinutesDifference(y(a.toDate()),n.duration);r.isSameOrAfter(i)&&r.isBefore(o)&&("remove"===s&&this.pauseSlots.delete(r.format("YYYY-MM-DDHH:mm")),"add"===s&&this.pauseSlots.add(r.format("YYYY-MM-DDHH:mm")))}},t.prototype.handleEarlySlot=function(e,s,n,i,o){for(;e.hasNext();){var a=e.next(),r=t.getMinutesDifference(y(a.toDate()),n.duration);r.isSameOrAfter(i)&&r.isBefore(o)&&("add"===s&&this.earlySlots.add(r.format("YYYY-MM-DDHH:mm")),"remove"===s&&this.earlySlots.delete(r.format("YYYY-MM-DDHH:mm")))}},t.decorators=[{type:s.Component,args:[{selector:"ngx-calendar",template:'<div class="week-calendar-wrapper">\n  <div class="week-calendar-header">\n\n\n    <div class="week-calendar-title">\n\n\n      <lib-calendar-header [start]="start"\n                           [end]="end"\n                           [headerConfiguration]="calendarConfiguration"\n                           [viewMode]="viewMode"\n                           (switchedView)="onSwithedView($event)"\n                           (startChanged)="onStartChanged($event)"></lib-calendar-header>\n\n    </div>\n\n  </div>\n\n  <div>\n\n\n    <lib-calendar-body [bodyConfiguration]="calendarConfiguration"\n                       [onlineSession]="onlineSession"\n                       [days]="days"\n                       [viewMode]="viewMode"\n                       [start]="start"\n                       [end]="end"\n                       [daysAvailability]="daysAvailability"\n                       [daysBusySlotNumber]="daysBusySlotNumber"\n                       [daysAvailabilitySlotNumber]="daysAvailabilitySlotNumber"\n                       [busySlots]="busySlots"\n                       [user]="user"\n                       [customer]="customer"\n                       [earlySlots]="earlySlots"\n                       [pauseSlots]="pauseSlots"\n                       [sessionsSlots]="sessionsSlots"\n                       [sessionsStartSlots]="sessionsStartSlots"\n                       [sessionsEndSlots]="sessionsEndSlots"\n                       (startChanged)="onStartChanged($event)"\n                       (sessionAdded)="onSessionAdded($event)"\n                       (sessionRemoved)="onSessionRemoved($event)"\n                       *ngIf="start && end && days && viewMode"></lib-calendar-body>\n\n  </div>\n</div>\n',styles:[".week-calendar-wrapper .week-calendar-header{padding-bottom:20px}@media (min-width:768px){.week-calendar-wrapper .week-calendar-header .week-calendar-title{width:90vw}}"]}]}],t.ctorParameters=function(){return[{type:s.ChangeDetectorRef},{type:d}]},t.propDecorators={user:[{type:s.Input}],customer:[{type:s.Input}],onlineSession:[{type:s.Input}],start:[{type:s.Input}],end:[{type:s.Input}],calendarConfiguration:[{type:s.Input}],viewModeChanged:[{type:s.Output}],sessionCreated:[{type:s.Output}],sessionRemoved:[{type:s.Output}],sessionsEntries:[{type:s.Input}],viewMode:[{type:s.Input}]},t}();var p=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[e.CommonModule,n.FlexLayoutModule,i.MatIconModule],declarations:[h,m,u],exports:[h,m,u]}]}],t}();t.CalendarComponent=h,t.EventType=r,t.NgxCalendarModule=p,t.ɵa=d,t.ɵb=m,t.ɵc=u,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=romainmarecat-ngx-calendar.umd.min.js.map